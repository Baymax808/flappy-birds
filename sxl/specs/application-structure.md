# 应用架构: 供应商管理系统

**开发日期**：2025-10-30
**标准需求**：specs/XXX/spec.md
**项目设计**：specs/XXX/plan.md

## 架构介绍

TODO

## 一、核心领域划分

系统的核心是“**供应商**”概念，但其完整视图和数据所有权分散在不同的业务子域中。建议将系统划分为以下几个核心界限子域：

### 供应商核心子域（Supplier Core）

**职责**：作为供应商基本信息的**单一事实来源**（SSoT, Single Source of Truth）。  
**核心数据实体**：Supplier（供应商）、Contact（联系人）、LegalEntity（法人实体）、Address（注册/办公地址）。  
**数据模型**：管理供应商的唯一编码、法定名称、统一社会信用代码、基础联系方式、注册地址及状态（如启用/冻结/黑名单）。此子域的数据具有最高权威性，其他子域通过供应商ID引用，不得自行修改核心属性。

### 采购与合同子域（Procurement & Contract）

**职责**：管理供应商相关的采购流程、合同签订、条款约定及履约跟踪。  
**核心数据实体**：Contract（合同）、PurchaseAgreement（采购协议）、PricingTier（价格阶梯）、ServiceLevelAgreement（SLA）。  
**数据模型**：通过供应商ID与核心子域关联。合同中可快照签约时的供应商关键信息（如联系人、银行账户）以确保历史可追溯性，但信息变更需监听核心子域发布的“供应商信息更新”事件进行同步或告警。

### 资质与合规子域（Qualification & Compliance）

**职责**：负责供应商准入审核、资质文件管理、合规性评估及风险评级。  
**核心数据实体**：QualificationRecord（资质记录）、ComplianceCheck（合规检查）、RiskRating（风险评级）、Certificate（证书/执照）。  
**数据模型**：持有供应商ID，并独立管理其行业资质（如ISO认证、安全生产许可）、审计报告、黑名单状态等。该子域决定供应商是否具备参与采购活动的资格，其评估结果可作为采购子域的前置条件。

### 绩效与协同子域（Performance & Collaboration）

**职责**：监控供应商交付表现、质量水平、协同效率，并支持持续改进。  
**核心数据实体**：PerformanceScorecard（绩效评分卡）、DeliveryRecord（交付记录）、QualityIncident（质量事件）、CollaborationLog（协同日志）。  
**数据模型**：基于供应商ID聚合来自采购、仓储、质检等系统的数据，生成多维度KPI（如准时交付率、退货率）。该子域的数据用于供应商分级管理、年度评审及战略合作决策，其历史记录在此子域具有权威性。

## 二、功能模块梳理

### 1. 供应商主数据管理页

该页面是整个系统的基础入口，用于创建、查看和维护供应商的权威主数据。

- **核心领域归属**：完全属于**供应商核心子域**。
- **功能内容**：包括供应商基本信息（名称、统一社会信用代码、状态）、注册地址、法人代表、默认联系人等字段的录入与编辑。支持状态变更（如启用/冻结/归档）并触发状态流转事件。
- **与其他子域交互**：
  - 向**资质与合规子域**发布“供应商创建”或“状态变更”事件，触发准入流程或风险重评；
  - 为**采购与合同子域**提供供应商ID及基础快照，用于合同关联；
  - **绩效与协同子域**通过该ID聚合历史绩效数据，但不反向修改主数据。
- **权限控制**：仅限主数据管理员或采购管理员编辑；普通采购员仅可查看；供应商用户不可访问此页面。

### 2. 供应商详情总览页

这是一个聚合型页面，虽以供应商核心数据为主框架，但整合了来自其他子域的关键信息。

- **核心领域归属**：主框架属于**供应商核心子域**，但各信息区块分别归属对应子域。
- **功能内容**：
  - 基础信息区块（来自核心子域）；
  - 合同摘要区块（来自采购与合同子域，显示生效合同数量、最近合同）；
  - 资质状态区块（来自资质与合规子域，显示是否准入、证书是否过期）；
  - 绩效评分区块（来自绩效与协同子域，显示最新季度评分）。
- **权限控制**：根据用户角色动态显示区块。例如，财务人员可能看不到绩效详情，合规人员看不到合同条款。
- **特别注意**:
  - **设计原则**：各区块独立加载，采用懒加载或按需请求机制，避免耦合。点击任一区块可跳转至对应子域的详情页。

### 3. 合同创建与编辑页

该页面用于起草、编辑采购合同，是采购业务的关键操作界面。

- **核心领域归属**：完全属于**采购与合同子域**。
- **功能内容**：选择供应商（通过调用供应商核心子域的搜索接口）、填写合同条款、上传附件、设置付款条件、选择模板等。支持保存草稿或提交审批。
- **与其他子域交互**：
  - 依赖**供应商核心子域**提供有效的供应商列表及基础信息（只读）；
  - 若合同涉及资质要求（如“必须具备ISO9001”），可调用**资质与合规子域**验证当前供应商是否满足；
  - 合同生效后，向**绩效与协同子域**发送“新合同生效”事件，用于后续绩效数据采集。
- **权限控制**：仅采购员、合同专员可创建；法务可编辑条款；供应商用户不可访问。
- **特别注意**:
  **数据快照**：在合同提交时，自动快照供应商的银行账户、联系人等关键信息，确保历史合同数据独立于主数据变更。

### 4. 合同详情页

用于查看已创建合同的完整内容、签署状态及关联信息。

- **核心领域归属**：**采购与合同子域**。
- **功能内容**：展示合同全文、签署状态（是否完成电子签）、生效日期、附件列表、付款条款快照等。
- **与其他子域交互**：
  - 显示的供应商名称和ID来自**供应商核心子域**，但不实时同步变更；
  - 可嵌入“绩效表现”卡片（来自绩效子域），展示该合同项下的交付评分；
  - 若合同被用于准入依据，可反向链接至**资质与合规子域**的准入记录。
- **权限控制**：采购相关角色可读写（如添加备注）；供应商用户仅可查看与其相关的合同（通过供应商ID过滤）。

### 5. 供应商准入申请与审核页

该页面支持内部发起或外部提交的供应商准入流程，是合规控制的起点。

- **核心领域归属**：**资质与合规子域**。
- **功能内容**：
  - 对内：采购员可为新供应商发起准入申请；
  - 对外：供应商通过自助门户提交注册信息（此数据同步至此页面）；
  - 审核员在此页面查看自动征信结果（如企查查API返回的风险信息）、人工审核资质文件、填写审核意见。
- **与其他子域交互**：
  - 依赖**供应商核心子域**创建临时或正式供应商记录；
  - 审核通过后，触发**供应商核心子域**将状态更新为“已准入”；
  - 若准入失败，通知**采购与合同子域**禁止创建合同。
- **权限控制**：仅合规团队可审核；采购员可提交申请；供应商用户仅能通过门户提交，不能访问此内部页面。

## 三、权限模块适配

系统共定义 4 类核心角色，覆盖内部管理与外部协同场景：

### 1. 主数据管理员（Master Data Steward）

- **核心领域归属**：主要服务于 **供应商核心子域**，对主数据拥有最高管理权。
- **页面交互详情**：
  - **供应商主数据管理页**：可创建、编辑、冻结、归档供应商；修改统一社会信用代码、注册地址等权威字段。
  - **供应商详情总览页**：可查看全部信息，包括其他子域聚合内容（但不可编辑非核心字段）。
- **权限边界**：
  - 无权访问合同条款、资质文件内容、绩效评分细节；
  - 不参与准入审核或合同审批流程；
  - 所有操作记录强制审计。

### 2. 采购专员（Procurement Specialist）

- **核心领域归属**：横跨 **供应商核心子域** 与 **采购与合同子域**，是日常采购操作主力。
- **页面交互详情**：
  - **供应商列表页 / 详情总览页**：可查看所有“已准入”供应商信息，但不可编辑主数据（仅可建议修改）。
  - **合同创建与编辑页**：可发起新合同，选择供应商、填写基础条款、上传附件，提交审批。
  - **合同详情页**：可查看已关联合同状态，添加履约备注。
  - **准入申请页**：可为新供应商发起准入申请，填写初步业务需求。
- **权限边界**：
  - 不能审批合同或准入申请；
  - 不能查看其他采购员负责的供应商（若启用组织隔离）；

### 3. 合同专员（Contract Manager）

- **核心领域归属**：专注 **采购与合同子域**，负责合同全生命周期管理。
- **页面交互详情**：
  - **合同创建与编辑页**：可编辑高级条款（如违约责任、知识产权）、选择标准模板、配置付款计划。
  - **合同审批工作台**：可处理合同审批任务，填写法律意见，退回修改。
  - **合同详情页**：可触发电子签署流程，查看签署状态，管理合同归档。
  - **供应商详情总览页**：可查看合同摘要，但无法跳转至资质或绩效详情（除非有交叉权限）。
- **权限边界**：
  - 不能创建供应商或修改主数据；
  - 不能审核资质或查看绩效原始数据；
  - 通常不直接与供应商用户交互（签署由系统自动通知）。

### 4. 合规审核员（Compliance Officer）

- **核心领域归属**：专属 **资质与合规子域**，负责风险控制与准入治理。
- **页面交互详情**：
  - **准入申请与审核页**：可查看自动征信结果（如司法风险、经营异常），人工审核资质文件，决定“通过/拒绝/补充材料”。
  - **资质文件管理页**：可查看、下载、标记所有供应商的资质文件，设置到期预警规则。
  - **供应商详情总览页**：可查看“合规状态”区块，点击跳转至完整审核记录。
- **权限边界**：
  - 不能创建合同或查看合同条款；
  - 不能编辑供应商主数据（仅可建议冻结）。


## 四、关键服务集成

==集成服务通过外部服务功能实现，是否需要特殊提示来选择最佳实现方式==
==外部服务不属于 IDE 内部功能，生成实际业务功能需要特别注意==

为支撑供应商全生命周期管理，系统需与以下关键服务进行集成，各集成服务按其支撑的子域和职责分类如下：

### 1. 企业身份与访问管理服务

**集成子域**：所有子域（统一认证与权限控制）  
**主要职责**：提供统一的用户身份认证、角色权限管理及单点登录（SSO）能力。  
**数据交互**：用户身份凭证、组织架构、角色权限映射。
**配置文件** services/company.md

### 2. 电子签章与合同管理系统

**集成子域**：采购与合同子域（Procurement & Contract）  
**主要职责**：支持合同在线起草、审批、电子签署及归档。  
**数据交互**：合同文档、签署状态、签署人信息、签署时间戳。
**配置文件** services/contract.md

## 五、国际化适配

适配中文（cn）、英语（en）两种语言。

**配置文件** language.md

## 六、应用类型支持

==讨论补充不用类型的支持适配==

### PC 端

**主要覆盖**：
- **供应商核心**：主数据创建、组织绑定、状态管理；
- **采购与合同**：合同起草、条款编辑、审批流处理；
- **资质与合规**：准入审核、黑名单管理、征信调用；
- **绩效与协同**：KPI 配置、评分卡调整、协同计划制定。

### H5 端

**主要覆盖**：
- **供应商核心**（只读）：查看自身基本信息；
- **采购与合同**（受限）：查看已生效合同、确认交付计划；
- **资质与合规**（写入）：上传/更新资质文件；
- **绩效与协同**（只读）：查看自身评分卡、提交申诉。
**明确排除**：
- 无权访问其他供应商数据；
- 无法创建合同、审核资质、配置绩效规则；
- 不涉及组织架构、主数据治理等内部管理功能。
